# DID self method specification
## Author
* Nikos Fotiou, [Mobile Multimedia Laboratory, AUEB](https://mm.aueb.gr)

## Abstract
The did self method enables DID document management without registries. Each
DID owner is responsible for maintaining their DID documents and the corresponding
revision history.

## DID Method 
The name of this DID method is: `self`

The method specific identifier is represented as the base64url value
of an Ed25519 public key. e.g.,

```
did:self:6varD0RjXZfW58v4DGtd7kltX6Kzn9fghX94LvrMDxo
```

Each DID is associated with a DID document and a 
list of proofs known as the `proof chain`. The DID document is a JSON-encoded file that must include at least
the `id` and the `controller` fields (as defined by [W3C's DID specification](https://www.w3.org/TR/did-core/)).
For the controller field we are using the [did:key method](https://w3c-ccg.github.io/did-method-key/).

Every time a DID document is created or updated a proof is calculated
and it is stored in the `proof chain`.
A proof is a compact encoded [JSON Web Signature (JWS)](https://tools.ietf.org/html/rfc7515).
The payload of the proof is a JSON string that includes four 
fields: 

* `did` The DID.
* `controller` The controller of the DID document.
* `version` A version number used for revoking deprecated documents.
* `sha-256` The base64url encoded hash of the DID document, calculated using SHA-256.

The signature of the proof is generated using EdDSA. 

## CRUD Operation Definitions
CRUD operations are implemented by the users. 

### Create
The Create operation initializes a did:self DID and creates an initial DID document. 
The proof of the initial DID document is signed using the DID
and it is the fist element of the proof chain. 

### Update
With the Update operation an existing DID document is replaced with a new one. 
Since only controllers can update a DID document, 
the proof of the new DID document must be generated 
by the controller of the **DID document being replaced**.
If the new proof and the last element of the proof chain are generated by the same controller, 
then the last element of the chain is replaced with the new proof, otherwise the new proof 
is appended to the proof chain.

### Read
The \emph{Read} operation simply outputs the DID document and 
the corresponding proof chain.

## DID document validation
Given a DID, a DID document, and a proof chain, any entity can attest
whether or not the DID document is a valid document for the given DID 
using the following protocol.

1. First, verify that the `sha-256` field of the payload of the last proof of the chain contains the hash of the DID document.
1. As a next step, verify that the `did` field of the payload of all proofs of the chain is equal to the DID.
1. Then, verify the first proof of the chain using the DID
1. Finally, starting from the second proof of the chain, verify all proofs using the `controller` field of the payload of their previous proof.





